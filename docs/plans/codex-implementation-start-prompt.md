# Codex 実装開始指示プロンプト（Harness-mem World-1）

以下をそのまま Codex に渡してください。

---

あなたは `harness-mem` リポジトリの実装担当です。  
実装は **必ず `Plans.md` を正本（Single Source of Truth）** として進めてください。

## 0) 目的

`Plans.md` に定義された World-1 計画を、TDDで安全に完了まで進めること。  
優先順は `Section 13` の直近実行キューに従うこと。

## 1) 作業開始時の必須手順

1. `Plans.md` を読み、最初の未着手タスクを1つ選ぶ。
2. そのタスクを `cc:WIP` に変更する。
3. 「テスト先行」で失敗テストを追加する（Red）。
4. 実装してテストを通す（Green）。
5. 必要に応じてリファクタし、テストを再実行（Refactor）。
6. 関連ドキュメントを更新する。
7. タスクを `cc:完了` に変更する。

## 2) 実装規律（必須）

1. テスト無しの実装は禁止。
2. 失敗再現テスト無しのバグ修正は禁止。
3. 同一原因で3回連続失敗したら停止して、原因・試行・次案を `Plans.md` に記録。
4. フォールバックでごまかさない。主経路を修正する。
5. backward compatibility は明示要求がない限り追加しない。
6. 変更範囲外のコードを勝手に整理しない。

## 3) 実行順序

`Plans.md` の Phase 順を厳守:

1. Phase 0（baseline固定）
2. Phase 1（Embedding provider化）
3. Phase 2（検索品質強化）
4. Phase 3（3層導線のプロダクト化）
5. Phase 4（Consolidation worker）
6. Phase 5（Python SDK）
7. Phase 6（LangChain統合）
8. Phase 7（Hardening）

## 4) 並列化ルール

`[P]` が付いたタスクのみ並列化可。  
ただし同一ファイル競合が起きる組み合わせは並列禁止。

## 5) 受け入れ判定

各タスク完了時に、最低限次を満たすこと:

1. 追加テストが存在し、テストが通る
2. 既存テスト非回帰
3. `Plans.md` のステータス更新完了
4. 変更理由を1-3行で記録

## 6) 失敗時の報告フォーマット

失敗したら以下フォーマットで返答:

1. 何が失敗したか（症状）
2. 原因仮説
3. 試した修正
4. 次に打つ手（最大3件、推奨を先頭）

## 7) 最初の着手タスク

まず `T0-001` から開始してください。  
完了後は `T0-002` へ進み、以降は `Section 13` の順で進めてください。

---

補足:
- 仕様判断で迷った場合は `Plans.md` を優先し、未定義なら `Plans.md` に判断ログを追記してから進めること。
- すべての変更は再現可能なテストで裏付けること。

